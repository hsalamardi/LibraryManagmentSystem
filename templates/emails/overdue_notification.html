{% extends 'emails/base_email.html' %}

{% block title %}Overdue Book Notice - {{ library_name }}{% endblock %}

{% block header %}
<span class="emoji">⚠️</span> Overdue Book Notice
{% endblock %}

{% block content %}
<p>Dear {{ user.get_full_name|default:user.username }},</p>

<p>We hope this message finds you well. We're writing to inform you that you have an overdue book in our library system.</p>

<div class="book-info">
    <div class="book-title">{{ book.title }}</div>
    <div class="book-author">by {{ book.author }}</div>
    {% if book.isbn %}
    <small><strong>ISBN:</strong> {{ book.isbn }}</small>
    {% endif %}
</div>

<div class="alert alert-danger">
    <strong>📅 Original Due Date:</strong> {{ borrowing.due_date|date:"F d, Y" }}<br>
    <strong>⏰ Days Overdue:</strong> <span style="font-size: 18px; font-weight: bold;">{{ days_overdue }} day{{ days_overdue|pluralize }}</span><br>
    {% if fine_amount > 0 %}
    <strong>💰 Current Fine:</strong> <span class="fine-amount">${{ fine_amount|floatformat:2 }}</span>
    {% endif %}
</div>

{% if days_overdue <= 7 %}
<div class="alert alert-warning">
    <strong>📋 Action Required:</strong> Please return this book as soon as possible to minimize additional fines.
</div>
{% elif days_overdue <= 14 %}
<div class="alert alert-danger">
    <strong>🚨 Urgent Action Required:</strong> This book is significantly overdue. Please return it immediately or contact us to discuss the situation.
</div>
{% else %}
<div class="alert alert-danger">
    <strong>🚨 Critical Notice:</strong> This book has been overdue for over two weeks. Immediate action is required. Please contact the library immediately.
</div>
{% endif %}

<p><strong>📋 What you need to do:</strong></p>
<ol>
    <li><strong>Return the book immediately</strong> to stop additional fines from accumulating</li>
    {% if fine_amount > 0 %}
    <li><strong>Pay the current fine</strong> of ${{ fine_amount|floatformat:2 }}</li>
    {% endif %}
    <li><strong>Contact us</strong> if you're unable to locate the book or need assistance</li>
</ol>

<p><strong>📍 How to return:</strong></p>
<ul>
    <li>Visit the library during operating hours</li>
    <li>Use the 24/7 book drop-off box</li>
    <li>Contact us at {{ library_phone }} if you need special arrangements</li>
</ul>

{% if fine_amount > 0 %}
<div class="date-info">
    <strong>💳 Payment Options:</strong><br>
    • Cash or card at the library<br>
    • Online payment (if available)<br>
    • Contact us for payment arrangements
</div>
{% endif %}

<div style="text-align: center; margin: 30px 0;">
    <a href="mailto:{{ library_email }}" class="btn">📧 Contact Library</a>
</div>

<p><strong>⚠️ Important:</strong> Continued failure to return overdue materials may result in:</p>
<ul>
    <li>Suspension of borrowing privileges</li>
    <li>Additional administrative fees</li>
    <li>Referral to collections (for significant amounts)</li>
</ul>

<p>We understand that circumstances can arise that prevent timely returns. If you're experiencing difficulties, please don't hesitate to contact us. We're here to help and work with you to resolve this matter.</p>

<p>Thank you for your immediate attention to this matter.</p>

<p>Sincerely,<br>
<strong>{{ library_name }} Team</strong><br>
📧 {{ library_email }}<br>
{% if library_phone %}📞 {{ library_phone }}{% endif %}</p>
{% endblock %}