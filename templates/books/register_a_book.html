<!DOCTYPE html>
{% extends 'landing_page.html' %}
{% load static %}

{% block body_block %}
<body>
    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-md-10">
                <div class="card shadow">
                    <div class="card-header bg-primary text-white">
                        <h2 class="mb-0"><i class="fas fa-plus-circle"></i> Add New Book</h2>
                    </div>
                    <div class="card-body">
                        <form method="post" enctype="multipart/form-data" class="needs-validation" novalidate>
                            {% csrf_token %}
                            
                            {% if form.errors %}
                                <div class="alert alert-danger">
                                    <h5>Please correct the following errors:</h5>
                                    {{ form.errors }}
                                </div>
                            {% endif %}
                            
                            <div class="row">
                                <!-- Basic Information -->
                                <div class="col-md-6">
                                    <h5 class="text-primary mb-3">Basic Information</h5>
                                    <div class="mb-3">
                                        <label for="{{ form.title.id_for_label }}" class="form-label">Title *</label>
                                        {{ form.title }}
                                    </div>
                                    <div class="mb-3">
                                        <label for="{{ form.author.id_for_label }}" class="form-label">Author *</label>
                                        {{ form.author }}
                                    </div>
                                    <div class="mb-3">
                                        <label for="{{ form.isbn.id_for_label }}" class="form-label">ISBN</label>
                                        {{ form.isbn }}
                                    </div>
                                    <div class="mb-3">
                                        <label for="{{ form.barcode.id_for_label }}" class="form-label">Barcode</label>
                                        <div class="input-group">
                                            {{ form.barcode }}
                                            <button type="button" class="btn btn-outline-secondary" id="generate-barcode-btn">
                                                <i class="fas fa-barcode"></i> Generate
                                            </button>
                                        </div>
                                        <div class="form-text">Scan or enter barcode, or click Generate to create one automatically</div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="{{ form.serial.id_for_label }}" class="form-label">Serial Number *</label>
                                        {{ form.serial }}
                                    </div>
                                    <div class="mb-3">
                                        <label for="{{ form.shelf.id_for_label }}" class="form-label">Shelf Location *</label>
                                        {{ form.shelf }}
                                    </div>
                                </div>
                                
                                <!-- Cover Image and Publication Details -->
                                <div class="col-md-6">
                                    <h5 class="text-primary mb-3">Cover Image & Publication</h5>
                                    <div class="mb-3">
                                        <label for="{{ form.cover_image.id_for_label }}" class="form-label">Book Cover</label>
                                        {{ form.cover_image }}
                                        <div class="form-text">Upload a book cover image (JPEG, PNG, GIF, WebP - Max 5MB)</div>
                                        <div id="cover-preview" class="mt-2" style="display: none;">
                                            <img id="preview-img" src="" alt="Cover Preview" class="img-thumbnail" style="max-width: 150px; max-height: 200px;">
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="{{ form.publisher.id_for_label }}" class="form-label">Publisher</label>
                                        {{ form.publisher }}
                                    </div>
                                    <div class="mb-3">
                                        <label for="{{ form.publication_date.id_for_label }}" class="form-label">Publication Date</label>
                                        {{ form.publication_date }}
                                    </div>
                                    <div class="mb-3">
                                        <label for="{{ form.edition.id_for_label }}" class="form-label">Edition</label>
                                        {{ form.edition }}
                                    </div>
                                    <div class="mb-3">
                                        <label for="{{ form.pages.id_for_label }}" class="form-label">Pages</label>
                                        {{ form.pages }}
                                    </div>
                                    <div class="mb-3">
                                        <label for="{{ form.language.id_for_label }}" class="form-label">Language</label>
                                        {{ form.language }}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Additional Details (Collapsible) -->
                            <div class="accordion mt-4" id="additionalDetails">
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="headingAdditional">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseAdditional">
                                            Additional Details (Optional)
                                        </button>
                                    </h2>
                                    <div id="collapseAdditional" class="accordion-collapse collapse" data-bs-parent="#additionalDetails">
                                        <div class="accordion-body">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="mb-3">
                                                        <label for="{{ form.dewey_code.id_for_label }}" class="form-label">Dewey Code</label>
                                                        {{ form.dewey_code }}
                                                    </div>
                                                    <div class="mb-3">
                                                        <label for="{{ form.volume.id_for_label }}" class="form-label">Volume</label>
                                                        {{ form.volume }}
                                                    </div>
                                                    <div class="mb-3">
                                                        <label for="{{ form.series.id_for_label }}" class="form-label">Series</label>
                                                        {{ form.series }}
                                                    </div>
                                                    <div class="mb-3">
                                                        <label for="{{ form.editor.id_for_label }}" class="form-label">Editor</label>
                                                        {{ form.editor }}
                                                    </div>
                                                    <div class="mb-3">
                                                        <label for="{{ form.translator.id_for_label }}" class="form-label">Translator</label>
                                                        {{ form.translator }}
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="mb-3">
                                                        <label for="{{ form.place_of_publication.id_for_label }}" class="form-label">Place of Publication</label>
                                                        {{ form.place_of_publication }}
                                                    </div>
                                                    <div class="mb-3">
                                                        <label for="{{ form.website.id_for_label }}" class="form-label">Website</label>
                                                        {{ form.website }}
                                                    </div>
                                                    <div class="mb-3">
                                                        <label for="{{ form.source.id_for_label }}" class="form-label">Source</label>
                                                        {{ form.source }}
                                                    </div>
                                                    <div class="mb-3">
                                                        <label for="{{ form.cover_type.id_for_label }}" class="form-label">Cover Type</label>
                                                        {{ form.cover_type }}
                                                    </div>
                                                    <div class="mb-3">
                                                        <label for="{{ form.condition.id_for_label }}" class="form-label">Condition</label>
                                                        {{ form.condition }}
                                                    </div>
                                                    <div class="mb-3">
                                                        <label for="{{ form.copy_number.id_for_label }}" class="form-label">Copy Number</label>
                                                        {{ form.copy_number }}
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="row">
                                                <div class="col-12">
                                                    <div class="mb-3">
                                                        <label for="{{ form.book_summary.id_for_label }}" class="form-label">Book Summary</label>
                                                        {{ form.book_summary }}
                                                    </div>
                                                    <div class="mb-3">
                                                        <label for="{{ form.contents.id_for_label }}" class="form-label">Table of Contents</label>
                                                        {{ form.contents }}
                                                    </div>
                                                    <div class="mb-3">
                                                        <label for="{{ form.keywords.id_for_label }}" class="form-label">Keywords</label>
                                                        {{ form.keywords }}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="d-flex justify-content-between mt-4">
                                <a href="{% url 'books:view_books_list' %}" class="btn btn-secondary">
                                    <i class="fas fa-arrow-left"></i> Back to Books
                                </a>
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="fas fa-save"></i> Add Book
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Image preview functionality
        document.getElementById('{{ form.cover_image.id_for_label }}').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('preview-img').src = e.target.result;
                    document.getElementById('cover-preview').style.display = 'block';
                };
                reader.readAsDataURL(file);
            } else {
                document.getElementById('cover-preview').style.display = 'none';
            }
        });
        
        // Barcode generation functionality
        document.getElementById('generate-barcode-btn').addEventListener('click', function() {
            // Generate a simple barcode based on timestamp and random number
            const timestamp = Date.now().toString();
            const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
            const barcode = 'LIB' + timestamp.slice(-8) + random;
            
            document.getElementById('{{ form.barcode.id_for_label }}').value = barcode;
        });
        
        // Form validation
        (function() {
            'use strict';
            window.addEventListener('load', function() {
                var forms = document.getElementsByClassName('needs-validation');
                var validation = Array.prototype.filter.call(forms, function(form) {
                    form.addEventListener('submit', function(event) {
                        if (form.checkValidity() === false) {
                            event.preventDefault();
                            event.stopPropagation();
                        }
                        form.classList.add('was-validated');
                    }, false);
                });
            }, false);
        })();
    </script>
</body>
{% endblock %}
